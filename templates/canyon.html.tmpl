<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="view-transition" content="same-origin">
    
    <style>
      /* content-visibility: auto removed - causes iOS Safari flicker on scroll */
      
      /* View Transitions for smooth page changes */
      @view-transition {
        navigation: auto;
      }
      
      /* Smooth fade for root */
      ::view-transition-old(root),
      ::view-transition-new(root) {
        animation-duration: 0.3s;
      }
      
      /* Crossfade animation */
      ::view-transition-old(root) {
        animation-name: fade-out;
      }
      
      ::view-transition-new(root) {
        animation-name: fade-in;
      }
      
      @keyframes fade-out {
        to {
          opacity: 0;
        }
      }
      
      @keyframes fade-in {
        from {
          opacity: 0;
        }
      }
      
      /* Smooth transitions for images specifically */
      camera-feed {
        view-transition-name: auto;
      }
      
      /* Smooth transition for navigation */
      .canyon-nav {
        view-transition-name: nav;
      }
      
      ::view-transition-old(nav),
      ::view-transition-new(nav) {
        animation-duration: 0.2s;
      }
    </style>
    
    <!-- Page Title -->
    <title>{{.Name}} Live Cameras | Utah Canyon Conditions</title>
    
    <!-- SEO & Social -->
    <meta name="description" content="Live camera feeds for {{if eq .Name "LCC"}}Little Cottonwood Canyon{{else}}Big Cottonwood Canyon{{end}}. Real-time road conditions and weather updates.">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://lcc.live{{if eq .Name "BCC"}}/bcc{{end}}">
    <meta property="og:title" content="{{.Name}} Live Cameras | Utah Canyon Conditions">
    <meta property="og:description" content="Live camera feeds for {{if eq .Name "LCC"}}Little Cottonwood Canyon{{else}}Big Cottonwood Canyon{{end}}. Real-time road conditions and weather updates.">
    <meta property="og:site_name" content="LCC.live">
    {{- if .Cameras -}}
    {{- range $index, $c := .Cameras -}}
    {{- if eq $index 0 -}}
    {{- if ne $c.Kind "iframe" -}}
    <meta property="og:image" content="https://lcc.live/image/{{$c.ID}}">
    <meta property="og:image:alt" content="{{$c.Alt}}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    {{- end -}}
    {{- end -}}
    {{- end -}}
    {{- end -}}
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://lcc.live{{if eq .Name "BCC"}}/bcc{{end}}">
    <meta name="twitter:title" content="{{.Name}} Live Cameras | Utah Canyon Conditions">
    <meta name="twitter:description" content="Live camera feeds for {{if eq .Name "LCC"}}Little Cottonwood Canyon{{else}}Big Cottonwood Canyon{{end}}.">
    {{- if .Cameras -}}
    {{- range $index, $c := .Cameras -}}
    {{- if eq $index 0 -}}
    {{- if ne $c.Kind "iframe" -}}
    <meta name="twitter:image" content="https://lcc.live/image/{{$c.ID}}">
    {{- end -}}
    {{- end -}}
    {{- end -}}
    {{- end -}}
    
    <!-- Mobile Optimization -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="{{.Name}} Live">
    <meta name="theme-color" content="#667eea">
    
    <!-- Resources -->
    <link rel="stylesheet" href="/s/style.css">
    <link rel="icon" type="image/png" href="/s/favicon.png">
    
    <!-- Prefetch -->
    {{- if eq .Name "LCC" -}}
    <link rel="prefetch" href="/bcc" as="document">
    {{- else -}}
    <link rel="prefetch" href="/" as="document">
    {{- end -}}
    
    <!-- Preconnect for analytics -->
    <link rel="preconnect" href="https://www.googletagmanager.com">
  </head>
  
  <body>
    <!-- Main Header -->
    <header role="banner">
      <!-- Canyon Navigation with Theme Toggle -->
      <nav class="canyon-nav" role="navigation" aria-label="Canyon selection">
        <div class="canyon-toggle">
        {{ if eq .Name "LCC" -}}
        <a href="/" 
           aria-current="page" 
           class="active" 
           role="button"
           aria-label="Little Cottonwood Canyon, currently selected">
          LCC
        </a>
        <a href="/bcc" 
           role="button"
           aria-label="Switch to Big Cottonwood Canyon">
          BCC
        </a>
        {{- else -}}
        <a href="/" 
           role="button"
           aria-label="Switch to Little Cottonwood Canyon">
          LCC
        </a>
        <a href="/bcc" 
           aria-current="page" 
           class="active" 
           role="button"
           aria-label="Big Cottonwood Canyon, currently selected">
          BCC
        </a>
        {{- end -}}
        </div>
      </nav>
      
    </header>
    
    <!-- Camera Grid -->
    <main role="main">
      <section 
        id="container" 
        role="region" 
        aria-label="{{if eq .Name "LCC"}}Little Cottonwood Canyon{{else}}Big Cottonwood Canyon{{end}} camera feeds">
        {{- range $index, $c := .Cameras -}}
        {{- if ne $c.Kind "roadstatus" -}}
        <camera-feed 
          tabindex="0" 
          role="article"
          aria-label="{{$c.Alt}} camera feed">
          
          {{- if eq $c.Kind "iframe" -}}
          <!-- Embedded iframe camera -->
          <iframe 
            loading="lazy" 
            src="{{$c.Src}}" 
            title="{{$c.Alt}}" 
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
            referrerpolicy="strict-origin-when-cross-origin"
            aria-label="{{$c.Alt}}">
          </iframe>
          {{- else -}}
          <!-- Standard image camera with link to camera detail page -->
          <a href="/camera/{{$c.ID}}" aria-label="View {{$c.Alt}} full page">
          {{- if le $index 1 -}}
          <img 
            src="/image/{{$c.ID}}" 
            alt="{{$c.Alt}}"
            loading="eager"
            class="in-viewport">
          {{- else -}}
          <img 
            src="/image/{{$c.ID}}" 
            alt="{{$c.Alt}}" 
            loading="lazy">
          {{- end -}}
          </a>
          {{- end -}}
          
          <div class="camera-footer">
            <h4>{{$c.Alt}}</h4>
            <button class="share-button" 
                    data-camera-id="{{$c.ID}}" 
                    data-camera-name="{{$c.Alt}}"
                    aria-label="Share {{$c.Alt}}"
                    title="Share this camera">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
              </svg>
            </button>
          </div>
        </camera-feed>
        {{- end -}}
        {{- end -}}
      </section>
    </main>
    
    <!-- Lightbox Overlay -->
    <the-overlay 
      role="dialog" 
      aria-modal="true" 
      aria-label="Enlarged camera view">
    </the-overlay>

    <script type="module" src="/s/script.mjs"></script>
  </body>
</html>
